# –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Supabase –¥–ª—è FLUS MVP

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ Supabase

1. –ó–∞–π–¥–∏ –Ω–∞ [supabase.com](https://supabase.com)
2. –ù–∞–∂–º–∏ **New Project**
3. –ó–∞–ø–æ–ª–Ω–∏ –¥–∞–Ω–Ω—ã–µ:
   - **Name**: flus-mvp (–∏–ª–∏ –ª—é–±–æ–µ –∏–º—è)
   - **Database Password**: (–∑–∞–ø–∏—à–∏ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å!)
   - **Region**: West EU (Copenhagen) - –±–ª–∏–∂–µ –∫ –ù–æ—Ä–≤–µ–≥–∏–∏
4. –ù–∞–∂–º–∏ **Create new project** –∏ –ø–æ–¥–æ–∂–¥–∏ 2-3 –º–∏–Ω—É—Ç—ã

### –®–∞–≥ 2: –°–∫–æ–ø–∏—Ä—É–π —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–π–¥–∏ –≤ **Settings** ‚Üí **API**
2. –°–∫–æ–ø–∏—Ä—É–π:
   - **Project URL** (—Ç–∏–ø–∞ `https://xxxxx.supabase.co`)
   - **anon public key** (–¥–ª–∏–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω)
3. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
NEXT_PUBLIC_SUPABASE_URL=—Ç–≤–æ–π_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=—Ç–≤–æ–π_anon_key
```

---

## üóÑÔ∏è –®–∞–≥ 3: –°–æ–∑–¥–∞–π —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 3.1 –û—Ç–∫—Ä–æ–π SQL Editor

1. –í Supabase Dashboard –ø–µ—Ä–µ–π–¥–∏ –≤ **SQL Editor** (–∏–∫–æ–Ω–∫–∞ `</>`)
2. –ù–∞–∂–º–∏ **New query**

### 3.2 –í—ã–ø–æ–ª–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π SQL

–°–∫–æ–ø–∏—Ä—É–π **–≤–µ—Å—å** SQL –∏–∑ —Ñ–∞–π–ª–∞ `supabase/migrations/00_complete_schema.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏ –µ–≥–æ.

–≠—Ç–æ—Ç SQL —Å–æ–∑–¥–∞—Å—Ç:

- ‚úÖ **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏)
- ‚úÖ **jobs** - –í–∞–∫–∞–Ω—Å–∏–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (–∞–¥—Ä–µ—Å, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- ‚úÖ **applications** - –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É + —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ **conversations** - –ß–∞—Ç—ã –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º –∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º
- ‚úÖ **messages** - –°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ (—Ç–µ–∫—Å—Ç + —Ñ–æ—Ç–æ + —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
- ‚úÖ **job_photos** - –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ä–∞–±–æ—Ç—ã (–¥–æ/–ø–æ—Å–ª–µ)
- ‚úÖ **achievements** - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ **user_achievements** - –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RLS):**
- ‚úÖ –†–∞–±–æ—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏
- ‚úÖ –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –Ω–∏—Ö
- ‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –§–æ—Ç–æ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∑–∞—è–≤–∫–∏

---

## üì∏ –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π Storage –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

### 4.1 –°–æ–∑–¥–∞–π Storage Bucket

1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Storage** –≤ Supabase Dashboard
2. –ù–∞–∂–º–∏ **New bucket**
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **Name**: `job-photos`
   - **Public bucket**: ‚úÖ **–î–ê** (—á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
   - **File size limit**: `5MB`
   - **Allowed MIME types**: `image/jpeg, image/png, image/webp`
4. –ù–∞–∂–º–∏ **Create bucket**

### 4.2 –ù–∞—Å—Ç—Ä–æ–π Storage Policies

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket, –≤—ã–ø–æ–ª–Ω–∏ SQL –∏–∑ `supabase/migrations/01_storage_policies.sql`:

```sql
-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –≤ —Å–≤–æ—é –ø–∞–ø–∫—É
CREATE POLICY "Users can upload photos to own folder"
ON storage.objects FOR INSERT TO authenticated
WITH CHECK (
  bucket_id = 'job-photos' 
  AND (storage.foldername(name))[1] = auth.uid()::text
);

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ñ–æ—Ç–æ (–¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∑–∞—è–≤–∫–∏)
CREATE POLICY "Users can view photos from their applications"
ON storage.objects FOR SELECT TO authenticated
USING (bucket_id = 'job-photos');

-- –†–∞–∑—Ä–µ—à–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö —Ñ–æ—Ç–æ
CREATE POLICY "Users can delete own photos"
ON storage.objects FOR DELETE TO authenticated
USING (
  bucket_id = 'job-photos' 
  AND (storage.foldername(name))[1] = auth.uid()::text
);
```

---

## üéØ –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É

### 5.1 –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—ã

–í **Table Editor** –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã:
- users
- jobs
- applications
- conversations
- messages
- job_photos
- achievements
- user_achievements

### 5.2 –ü—Ä–æ–≤–µ—Ä—å Storage

–í **Storage** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å bucket `job-photos` —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.

### 5.3 –ü—Ä–æ–≤–µ—Ä—å RLS

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–∫–ª—é—á–µ–Ω–Ω—ã–π RLS (–≤ Table Editor –±—É–¥–µ—Ç –∑–µ–ª–µ–Ω—ã–π —â–∏—Ç üõ°Ô∏è).

---

## üöÄ –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π http://localhost:3000

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å:
1. –ó–∞–π–¥–∏ –Ω–∞ `/login`
2. –í—ã–±–µ—Ä–∏ **Arbeidsgiver** (üíº)
3. –ù–∞–∂–º–∏ **Logg inn med Vipps**
4. –ü–µ—Ä–µ–π–¥–∏ –≤ `/jobber/ny`
5. –°–æ–∑–¥–∞–π —Ç–µ—Å—Ç–æ–≤—É—é —Ä–∞–±–æ—Ç—É —Å:
   - –ê–¥—Ä–µ—Å–æ–º
   - –¢–∏–ø–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (Fleksibel/Frist/Fast tid)
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫:
1. –û—Ç–∫—Ä–æ–π –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä/–ø—Ä–æ—Ñ–∏–ª—å
2. –ó–∞–π–¥–∏ –Ω–∞ `/login`
3. –í—ã–±–µ—Ä–∏ **Jobbs√∏ker** (üë∑)
4. –ù–∞–∂–º–∏ **Logg inn med Vipps**
5. –ù–∞–π–¥–∏ —Ä–∞–±–æ—Ç—É –≤ `/jobber`
6. –ü–æ–¥–∞–π –∑–∞—è–≤–∫—É
7. –í —á–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤—å "–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É"
8. **–ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ "–¥–æ" —Ä–∞–±–æ—Ç—ã**
9. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–∑–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ "–ø–æ—Å–ª–µ"**
10. –û—Ç–º–µ—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å (–ø—Ä–æ–≤–µ—Ä–∫–∞):
1. –í–µ—Ä–Ω–∏—Å—å –≤ –ø–µ—Ä–≤—ã–π –±—Ä–∞—É–∑–µ—Ä
2. –ü–µ—Ä–µ–π–¥–∏ –≤ `/samtaler`
3. –û—Ç–∫—Ä–æ–π —á–∞—Ç —Å —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º
4. **–ü–æ—Å–º–æ—Ç—Ä–∏ —Ñ–æ—Ç–æ "–¥–æ" –∏ "–ø–æ—Å–ª–µ"**
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

```
job-photos/
  ‚îî‚îÄ‚îÄ {worker_user_id}/
      ‚îî‚îÄ‚îÄ {application_id}/
          ‚îú‚îÄ‚îÄ before_timestamp.jpg
          ‚îú‚îÄ‚îÄ before_timestamp_2.jpg
          ‚îú‚îÄ‚îÄ after_timestamp.jpg
          ‚îî‚îÄ‚îÄ after_timestamp_2.jpg
```

**–ü—Ä–∏–º–µ—Ä:**
```
job-photos/u_abc123def/a_xyz789abc/before_1729520000.jpg
```

---

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏ —Å —Ñ–æ—Ç–æ:
```sql
SELECT 
  a.id,
  j.title as job_title,
  u.email as worker_email,
  a.status,
  COUNT(jp.id) as photo_count
FROM applications a
JOIN jobs j ON a.job_id = j.id
JOIN users u ON a.applicant_id = u.id
LEFT JOIN job_photos jp ON a.id = jp.application_id
GROUP BY a.id, j.title, u.email, a.status;
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞–±–æ—Ç–Ω–∏–∫–∞:
```sql
SELECT * FROM worker_statistics 
WHERE worker_id = 'u_xxx';
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è:
```sql
SELECT * FROM job_statistics 
WHERE employer_id = 'u_xxx';
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö** - –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã
2. **Storage bucket –ø—É–±–ª–∏—á–Ω—ã–π** - —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. **–§–æ—Ç–æ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
4. **–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å** —Ä–∞–±–æ—Ç—É, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `completed`
5. **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ:

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –≤ —á–∞—Ç–µ
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≥–∞–ª–µ—Ä–µ—é —Ñ–æ—Ç–æ –≤ —á–∞—Ç–µ
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ñ–æ—Ç–æ

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –ª—é–±–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö –ø—É–Ω–∫—Ç–æ–≤! üöÄ
